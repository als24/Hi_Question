{"version":3,"sources":["webpack:///./src/components/jyf-parser/jyf-parser.vue?6d65","webpack:///./src/components/jyf-parser/jyf-parser.vue?e6f2","webpack:///./src/components/jyf-parser/jyf-parser.vue?5424","webpack:///./src/components/jyf-parser/jyf-parser.vue?1a2a","uni-app:///src/components/jyf-parser/jyf-parser.vue","webpack:///./src/components/jyf-parser/jyf-parser.vue?6b4d","webpack:///./src/components/jyf-parser/jyf-parser.vue?0098"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuH;AACvH;AAC8D;AACL;AACa;;;AAGtE;AACmI;AACnI,gBAAgB,gJAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,qFAAM;AACR,EAAE,8FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,yFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAuc,CAAgB,meAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsC3d;AAAA,IAEA,iEAFA;AAAA,IAIA,+DAJA;;AAKA,a,CAAA;AACA;;AACA;AACA;AACA;AADA;;AAEA;AACA;;eAMA;AACA,gBADA;AAEA,MAFA,kBAEA;AACA;AAOA,iBAPA;AAQA,gBARA;AASA,eATA;AAUA;AAVA;AAYA,GAfA;AAiBA;AACA;AADA,GAjBA;AAqBA;AACA,gBADA;AAGA;AACA,mBADA;AAEA;AAFA,KAHA;AAQA;AACA,mBADA;AAEA;AAFA,KARA;AAYA,sBAZA;AAaA,oBAbA;AAeA,0BAfA;AAkBA,uBAlBA;AAoBA,yBApBA;AAqBA,sBArBA;AAsBA,gCAtBA;AAuBA,wBAvBA;AAwBA,uBAxBA;AAyBA;AAzBA,GArBA;AAgDA;AACA,QADA,gBACA,KADA,EACA;AACA;AACA;AAHA,GAhDA;AAqDA,SArDA,qBAqDA;AAIA;AACA;;AACA;AACA;AACA;AADA;AAEA,KAHA;;AAIA;AAAA;;AACA,6BADA,CAGA;;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;;AAEA,oBAdA,CAeA;;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA,4BADA;AAEA,uBAFA;AAGA,2BAHA;AAIA;AAAA;AAAA;AAJA;AAiBA;AACA,KAvCA;;AAwCA;AACA,GAxGA;AAyGA,eAzGA,2BAyGA;AAIA;AASA,uDACA;AACA;AADA;AAIA,KAdA;AAeA;AACA,GA7HA;AA8HA;AAkBA,cAlBA,sBAkBA,IAlBA,EAkBA,MAlBA,EAkBA;AAAA;;AA4JA;AACA,iBACA,uBADA,KAEA;AACA,4CADA,CAEA;;AACA;AACA;AACA,8BACA,uBADA,KAEA;AACA;AACA;AACA;AACA,SARA,MAQA;;AACA;AACA,OAbA,MAaA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AADA;;AAEA;;AACA;AACA;;AACA;;AACA;AACA,eAJA,MAIA;AACA;AACA,WAbA,EAaA,IAbA;AAcA;;AACA;AACA,OApBA,MAoBA;AACA;AACA;AACA,OAHA,MAIA;AAIA;AACA,6DACA;AACA,+DACA;AACA;AADA;AAGA;AACA;AACA;;AAIA;AAAA,qCACA,CADA,EACA,CADA;AAEA;AACA;AACA;;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gCADA;AAEA;AAFA,yBAGA,OAHA,CAGA,OAHA,EAGA;AACA;AACA;AACA,uBANA;AAOA,qBATA,MAUA;AACA;AAEA,iBAjBA,MAmBA;AACA,gEADA;AAEA;;AACA;AACA;AAWA;AACA;;AACA,oCACA;AA1CA;;AACA;AAAA,gBAEA,CAFA,EAEA,IAFA;AAAA,gBAwBA,GAxBA;;AAAA;AA0CA;AACA,SA5CA;;AA6CA;AAUA,OA7DA;AA+DA;AACA;AACA;AAKA,qCAMA,MANA,CAMA,MANA,EAMA,kBANA,GAMA,IANA,CAMA;AAEA;;AACA;AACA;;AACA;AACA;;AACA;AAEA,SAfA;AAiBA,OAtBA,EAsBA,GAtBA;AAuBA;AACA,KA1TA;AA2TA,WA3TA,qBA2TA;AAAA;AAKA;;AACA;AACA,kHACA,OADA,CACA,QADA,EACA,GADA,OAEA,qCACA;AACA;AACA,8HACA,GADA,IACA,eADA;AAEA;AACA;AACA,qEACA;AACA;AACA;;AACA;AAEA,KAjVA;AAkVA,cAlVA,sBAkVA,GAlVA,EAkVA;AAAA;;AACA,2BACA;AACA;AADA;;AAkBA;AACA,4HACA,YADA,GAEA,IAFA,CAEA;AACA,+BACA;AACA;AADA;AAGA;AACA;AACA,SATA;AAUA,OAXA;;AAYA,uCACA;AAEA;AAOA;AAEA,KA9XA;AA+XA,mBA/XA,2BA+XA,EA/XA,EA+XA;AACA,8CAEA;AACA;AADA;AAEA,KApYA;AAqYA;AACA,WAtYA,mBAsYA,IAtYA,EAsYA,GAtYA,EAsYA;AAWA;AACA;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA,6EACA;AACA;AACA;AACA,OANA,EAMA,IANA;;AAOA;AACA;AACA,gEACA,2BACA;AAEA,KApaA;AAqaA,SAraA,iBAqaA,CAraA,EAqaA;AAEA,6BACA;AAEA,KA1aA;AA2aA,QA3aA,gBA2aA,CA3aA,EA2aA;AAEA;AACA;;AACA;AACA;;AACA;AACA,uEADA;AAEA;AAFA;AAIA,SANA,MAMA;AACA;AACA;AACA;AACA,gFADA;AAEA;AAFA;;AAOA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AAEA,KAzcA;AA0cA,eA1cA,uBA0cA,CA1cA,EA0cA;AAEA,iCACA;AAEA,KA/cA;AAgdA,cAhdA,sBAgdA,CAhdA,EAgdA;AAEA;;AACA;AACA;AACA,sFACA;AACA;AACA;AACA;;AACA;;AACA;AACA;AAEA;AA9dA;AA9HA,C;;;;;;;;;;;;;;ACvDA;AAAA;AAAA;AAAA;AAA0pB,CAAgB,8pBAAG,EAAC,C;;;;;;;;;;;ACA9qB;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/jyf-parser/jyf-parser.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./jyf-parser.vue?vue&type=template&id=7d1cca22&\"\nvar renderjs\nimport script from \"./jyf-parser.vue?vue&type=script&lang=js&\"\nexport * from \"./jyf-parser.vue?vue&type=script&lang=js&\"\nimport style0 from \"./jyf-parser.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"src/components/jyf-parser/jyf-parser.vue\"\nexport default component.exports","export * from \"-!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./jyf-parser.vue?vue&type=template&id=7d1cca22&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./jyf-parser.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./jyf-parser.vue?vue&type=script&lang=js&\"","<!--\r\n  parser 主模块组件\r\n  github：https://github.com/jin-yufeng/Parser \r\n  docs：https://jin-yufeng.github.io/Parser\r\n  插件市场：https://ext.dcloud.net.cn/plugin?id=805\r\n  author：JinYufeng\r\n  update：2020/03/26\r\n-->\r\n<template>\r\n  <view style=\"display:inherit;\">\r\n    <slot v-if=\"!nodes.length\" />\r\n    <view class=\"top\"\r\n          :style=\"showAm+(selectable?';user-select:text;-webkit-user-select:text':'')\"\r\n          :animation=\"scaleAm\"\r\n          @tap=\"_tap\"\r\n          @touchstart=\"_touchstart\"\r\n          @touchmove=\"_touchmove\">\r\n      <!--#ifdef H5-->\r\n      <div :id=\"'rtf'+uid\"></div>\r\n      <!--#endif-->\r\n      <!--#ifndef H5-->\r\n      <trees :nodes=\"nodes\"\r\n             :lazy-load=\"lazyLoad\"\r\n             :loadVideo=\"loadVideo\" />\r\n      <!--#endif-->\r\n    </view>\r\n    <image v-for=\"(item, index) in imgs\"\r\n           v-bind:key=\"index\"\r\n           :id=\"index\"\r\n           :src=\"item\"\r\n           hidden\r\n           @load=\"_load\" />\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n// #ifndef H5\r\nimport trees from './libs/trees';\r\nvar cache = {},\r\n  // #ifdef MP-WEIXIN || MP-TOUTIAO\r\n  fs = uni.getFileSystemManager ? uni.getFileSystemManager() : null,\r\n  // #endif\r\n  Parser = require('./libs/MpHtmlParser.js');\r\nvar document; // document 补丁包 https://jin-yufeng.github.io/Parser/#/instructions?id=document\r\n// 计算 cache 的 key\r\nfunction hash (str) {\r\n  for (var i = str.length, val = 5381; i--;)\r\n    val += (val << 5) + str.charCodeAt(i);\r\n  return val;\r\n}\r\n// #endif\r\n// #ifdef H5\r\nvar rpx = uni.getSystemInfoSync().screenWidth / 750,\r\n  cfg = require('./libs/config.js');\r\n// #endif\r\nexport default {\r\n  name: 'parser',\r\n  data () {\r\n    return {\r\n      // #ifdef APP-PLUS\r\n      loadVideo: false,\r\n      // #endif\r\n      // #ifdef H5\r\n      uid: this._uid,\r\n      // #endif\r\n      scaleAm: '',\r\n      showAm: '',\r\n      nodes: [],\r\n      imgs: []\r\n    }\r\n  },\r\n  // #ifndef H5\r\n  components: {\r\n    trees\r\n  },\r\n  // #endif\r\n  props: {\r\n    'html': null,\r\n    // #ifndef MP-ALIPAY\r\n    'autopause': {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n    // #endif\r\n    'autosetTitle': {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n    'compress': Number,\r\n    'domain': String,\r\n    // #ifndef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n    'gestureZoom': Boolean,\r\n    // #endif\r\n    // #ifdef MP-WEIXIN || MP-QQ || H5 || APP-PLUS\r\n    'lazyLoad': Boolean,\r\n    // #endif\r\n    'selectable': Boolean,\r\n    'tagStyle': Object,\r\n    'showWithAnimation': Boolean,\r\n    'useAnchor': Boolean,\r\n    'useCache': Boolean,\r\n    'xml': Boolean\r\n  },\r\n  watch: {\r\n    html (html) {\r\n      this.setContent(html);\r\n    }\r\n  },\r\n  mounted () {\r\n    // #ifdef APP-NVUE\r\n    console.error('本组件暂不支持 NVUE');\r\n    // #endif\r\n    // 图片数组\r\n    this.imgList = [];\r\n    this.imgList.each = function (f) {\r\n      for (var i = 0, len = this.length; i < len; i++)\r\n        this.setItem(i, f(this[i], i, this));\r\n    }\r\n    this.imgList.setItem = function (i, src) {\r\n      if (!i || !src) return;\r\n      // #ifndef MP-ALIPAY || APP-PLUS\r\n      // 去重\r\n      if (src.indexOf('http') == 0 && this.includes(src)) {\r\n        var newSrc = '';\r\n        for (var j = 0, c; c = src[j]; j++) {\r\n          if (c == '/' && src[j - 1] != '/' && src[j + 1] != '/') break;\r\n          newSrc += Math.random() > 0.5 ? c.toUpperCase() : c;\r\n        }\r\n        newSrc += src.substr(j);\r\n        return this[i] = newSrc;\r\n      }\r\n      // #endif\r\n      this[i] = src;\r\n      // 暂存 data src\r\n      if (src.includes('data:image')) {\r\n        var filePath, info = src.match(/data:image\\/(\\S+?);(\\S+?),(.+)/);\r\n        if (!info) return;\r\n        // #ifdef MP-WEIXIN || MP-TOUTIAO\r\n        filePath = `${wx.env.USER_DATA_PATH}/${Date.now()}.${info[1]}`;\r\n        fs && fs.writeFile({\r\n          filePath,\r\n          data: info[3],\r\n          encoding: info[2],\r\n          success: () => this[i] = filePath\r\n        })\r\n        // #endif\r\n        // #ifdef APP-PLUS\r\n        filePath = `_doc/parser_tmp/${Date.now()}.${info[1]}`;\r\n        var bitmap = new plus.nativeObj.Bitmap();\r\n        bitmap.loadBase64Data(src, () => {\r\n          bitmap.save(filePath, {}, () => {\r\n            bitmap.clear()\r\n            this[i] = filePath;\r\n          })\r\n        })\r\n        // #endif\r\n      }\r\n    }\r\n    if (!this.nodes.length) this.setContent(this.html);\r\n  },\r\n  beforeDestroy () {\r\n    // #ifdef H5\r\n    if (this._observer) this._observer.disconnect();\r\n    // #endif\r\n    this.imgList.each(src => {\r\n      // #ifdef APP-PLUS\r\n      if (src && src.includes('_doc')) {\r\n        plus.io.resolveLocalFileSystemURL(src, entry => {\r\n          entry.remove();\r\n        });\r\n      }\r\n      // #endif\r\n      // #ifdef MP-WEIXIN || MP-TOUTIAO\r\n      if (src && src.includes(uni.env.USER_DATA_PATH))\r\n        fs && fs.unlink({\r\n          filePath: src\r\n        })\r\n      // #endif\r\n    })\r\n    clearInterval(this._timer);\r\n  },\r\n  methods: {\r\n    // #ifdef H5\r\n    _Dom2Str (nodes) {\r\n      var str = '';\r\n      for (var node of nodes) {\r\n        if (node.type == 'text')\r\n          str += node.text;\r\n        else {\r\n          str += ('<' + node.name);\r\n          for (var attr in node.attrs || {})\r\n            str += (' ' + attr + '=\"' + node.attrs[attr] + '\"');\r\n          if (!node.children || !node.children.length) str += '>';\r\n          else str += ('>' + this._Dom2Str(node.children) + '</' + node.name + '>');\r\n        }\r\n      }\r\n      return str;\r\n    },\r\n    // #endif\r\n    setContent (html, append) {\r\n      // #ifdef H5\r\n      if (!html) {\r\n        if (this.rtf && !append) this.rtf.parentNode.removeChild(this.rtf);\r\n        return;\r\n      }\r\n      if (typeof html != 'string') html = this._Dom2Str(html.nodes || html);\r\n      // 处理 rpx\r\n      if (html.includes('rpx'))\r\n        html = html.replace(/[0-9.]*rpx/g, $ => parseFloat($) * rpx + 'px');\r\n      var div = document.createElement('div');\r\n      if (!append) {\r\n        // 处理 tag-style 和 userAgentStyles\r\n        let style = '<style>@keyframes show{0%{opacity:0}100%{opacity:1}}';\r\n        for (var item in cfg.userAgentStyles)\r\n          style += `${item}{${cfg.userAgentStyles[item]}}`;\r\n        for (item in this.tagStyle)\r\n          style += `${item}{${this.tagStyle[item]}}`;\r\n\r\n        style += '</style>';\r\n        html = style + html;\r\n        if (this.rtf) this.rtf.parentNode.removeChild(this.rtf);\r\n        this.rtf = div;\r\n      } else {\r\n        if (!this.rtf) this.rtf = div;\r\n        else this.rtf.appendChild(div);\r\n      }\r\n      div.innerHTML = html;\r\n      for (var styles = this.rtf.getElementsByTagName('style'), i = 0, style; style = styles[i++];) {\r\n        style.innerHTML = style.innerHTML.replace(/\\s*body/g, '#rtf' + this._uid);\r\n        style.setAttribute('scoped', 'true');\r\n      }\r\n      // 懒加载\r\n      if (!this._observer && this.lazyLoad && IntersectionObserver) {\r\n        this._observer = new IntersectionObserver(changes => {\r\n          for (let item, i = 0; item = changes[i++];) {\r\n            if (item.isIntersecting) {\r\n              item.target.src = item.target.getAttribute('data-src');\r\n              item.target.removeAttribute('data-src');\r\n              this._observer.unobserve(item.target);\r\n            }\r\n          }\r\n        }, {\r\n          rootMargin: '900px 0px 900px 0px'\r\n        })\r\n      }\r\n      var _ts = this;\r\n      // 获取标题\r\n      var title = this.rtf.getElementsByTagName('title');\r\n      if (title.length && this.autosetTitle)\r\n        uni.setNavigationBarTitle({\r\n          title: title[0].innerText\r\n        })\r\n      // 图片处理\r\n      this.imgList.length = 0;\r\n      var imgs = this.rtf.getElementsByTagName('img');\r\n      for (let i = 0, j = 0, img; img = imgs[i]; i++) {\r\n        img.style.maxWidth = '100%';\r\n        var src = img.getAttribute('src');\r\n        if (this.domain && src) {\r\n          if (src[0] == '/') {\r\n            if (src[1] == '/')\r\n              img.src = (this.domain.includes('://') ? this.domain.split('://')[0] : '') + ':' + src;\r\n            else img.src = this.domain + src;\r\n          } else if (!src.includes('://')) img.src = this.domain + '/' + src;\r\n        }\r\n        if (!img.hasAttribute('ignore') && img.parentElement.nodeName != 'A') {\r\n          img.i = j++;\r\n          _ts.imgList.push(img.src || img.getAttribute('data-src'));\r\n          img.onclick = function () {\r\n            var preview = true;\r\n            this.ignore = () => preview = false;\r\n            _ts.$emit('imgtap', this);\r\n            if (preview) {\r\n              uni.previewImage({\r\n                current: this.i,\r\n                urls: _ts.imgList\r\n              });\r\n            }\r\n          }\r\n        }\r\n        img.onerror = function () {\r\n          _ts.$emit('error', {\r\n            source: 'img',\r\n            target: this\r\n          });\r\n        }\r\n        if (_ts.lazyLoad && this._observer && img.src && img.i != 0) {\r\n          img.setAttribute('data-src', img.src);\r\n          img.removeAttribute('src');\r\n          this._observer.observe(img);\r\n        }\r\n      }\r\n      // 链接处理\r\n      var links = this.rtf.getElementsByTagName('a');\r\n      for (var link of links) {\r\n        link.onclick = function () {\r\n          var jump = true,\r\n            href = this.getAttribute('href');\r\n          _ts.$emit('linkpress', {\r\n            href,\r\n            ignore: () => jump = false\r\n          });\r\n          if (jump && href) {\r\n            if (href[0] == '#') {\r\n              if (_ts.useAnchor) {\r\n                _ts.navigateTo({\r\n                  id: href.substr(1)\r\n                })\r\n              }\r\n            } else if (href.indexOf('http') == 0 || href.indexOf('//') == 0)\r\n              return true;\r\n            else {\r\n              uni.navigateTo({\r\n                url: href\r\n              })\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n      }\r\n      // 视频处理\r\n      var videos = this.rtf.getElementsByTagName('video');\r\n      _ts.videoContexts = videos;\r\n      for (let video, i = 0; video = videos[i++];) {\r\n        video.style.maxWidth = '100%';\r\n        video.onerror = function () {\r\n          _ts.$emit('error', {\r\n            source: 'video',\r\n            target: this\r\n          });\r\n        }\r\n        video.onplay = function () {\r\n          if (_ts.autopause)\r\n            for (let item, i = 0; item = _ts.videoContexts[i++];)\r\n              if (item != this) item.pause();\r\n        }\r\n      }\r\n      // 音频处理\r\n      var audios = this.rtf.getElementsByTagName('audios');\r\n      for (var audio of audios)\r\n        audio.onerror = function () {\r\n          _ts.$emit('error', {\r\n            source: 'audio',\r\n            target: this\r\n          });\r\n        }\r\n      this.document = this.rtf;\r\n      if (!append) document.getElementById('rtf' + this._uid).appendChild(this.rtf);\r\n      this.$nextTick(() => {\r\n        this.nodes = [1];\r\n        this.$emit('load');\r\n      })\r\n      setTimeout(() => this.showAm = '', 500);\r\n      // #endif\r\n      // #ifndef H5\r\n      var nodes;\r\n      if (!html)\r\n        return this.nodes = [];\r\n      else if (typeof html == 'string') {\r\n        let parser = new Parser(html, this);\r\n        // 缓存读取\r\n        if (this.useCache) {\r\n          var hashVal = hash(html);\r\n          if (cache[hashVal])\r\n            nodes = cache[hashVal];\r\n          else {\r\n            nodes = parser.parse();\r\n            cache[hashVal] = nodes;\r\n          }\r\n        } else nodes = parser.parse();\r\n        this.$emit('parse', nodes);\r\n      } else if (Object.prototype.toString.call(html) == '[object Array]') {\r\n        // 非本插件产生的 array 需要进行一些转换\r\n        if (html.length && html[0].PoweredBy != 'Parser') {\r\n          let parser = new Parser(html, this);\r\n          (function f (ns) {\r\n            for (var i = 0, n; n = ns[i]; i++) {\r\n              if (n.type == 'text') continue;\r\n              n.attrs = n.attrs || {};\r\n              for (var item in n.attrs)\r\n                if (typeof n.attrs[item] != 'string') n.attrs[item] = n.attrs[item].toString();\r\n              parser.matchAttr(n, parser);\r\n              if (n.children && n.children.length) {\r\n                parser.STACK.push(n);\r\n                f(n.children);\r\n                parser.popNode(parser.STACK.pop());\r\n              } else n.children = void 0;\r\n            }\r\n          })(html);\r\n        }\r\n        nodes = html;\r\n      } else if (typeof html == 'object' && html.nodes) {\r\n        nodes = html.nodes;\r\n        console.warn('错误的 html 类型：object 类型已废弃');\r\n      } else\r\n        return console.warn('错误的 html 类型：' + typeof html);\r\n      // #ifdef APP-PLUS\r\n      this.loadVideo = false;\r\n      // #endif\r\n      if (document) this.document = new document(this.nodes, 'nodes', this);\r\n      if (append) this.nodes = this.nodes.concat(nodes);\r\n      else this.nodes = nodes;\r\n      if (nodes.length && nodes[0].title && this.autosetTitle)\r\n        uni.setNavigationBarTitle({\r\n          title: nodes[0].title\r\n        })\r\n      this.$nextTick(() => {\r\n        this.imgList.length = 0;\r\n        this.videoContexts = [];\r\n        // #ifdef MP-TOUTIAO\r\n        setTimeout(() => {\r\n          // #endif\r\n          var f = (cs) => {\r\n            for (let i = 0, c; c = cs[i++];) {\r\n              if (c.$options.name == 'trees') {\r\n                for (var j = c.nodes.length, item; item = c.nodes[--j];) {\r\n                  if (item.c) continue;\r\n                  if (item.name == 'img') {\r\n                    this.imgList.setItem(item.attrs.i, item.attrs.src);\r\n                    // #ifndef MP-ALIPAY\r\n                    if (!c.observer && !c.imgLoad && item.attrs.i != '0') {\r\n                      if (this.lazyLoad && uni.createIntersectionObserver) {\r\n                        c.observer = uni.createIntersectionObserver(c);\r\n                        c.observer.relativeToViewport({\r\n                          top: 900,\r\n                          bottom: 900\r\n                        }).observe('._img', () => {\r\n                          c.imgLoad = true;\r\n                          c.observer.disconnect();\r\n                        })\r\n                      } else\r\n                        c.imgLoad = true;\r\n                    }\r\n                    // #endif\r\n                  }\r\n                  // #ifndef MP-ALIPAY\r\n                  else if (item.name == 'video') {\r\n                    var ctx = uni.createVideoContext(item.attrs.id, c);\r\n                    ctx.id = item.attrs.id;\r\n                    this.videoContexts.push(ctx);\r\n                  }\r\n                  // #endif\r\n                  // #ifdef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n                  if (item.attrs && item.attrs.id) {\r\n                    this.anchors = this.anchors || [];\r\n                    this.anchors.push({\r\n                      id: item.attrs.id,\r\n                      node: c\r\n                    })\r\n                  }\r\n                  // #endif\r\n                }\r\n              }\r\n              if (c.$children.length)\r\n                f(c.$children)\r\n            }\r\n          }\r\n          f(this.$children);\r\n          // #ifdef MP-TOUTIAO\r\n        }, 200)\r\n        this.$emit('load');\r\n        // #endif\r\n        // #ifdef APP-PLUS\r\n        setTimeout(() => {\r\n          this.loadVideo = true;\r\n        }, 3000);\r\n        // #endif\r\n      })\r\n      // #endif\r\n      var height;\r\n      clearInterval(this._timer);\r\n      this._timer = setInterval(() => {\r\n        // #ifdef H5\r\n        var res = [this.rtf.getBoundingClientRect()];\r\n        // #endif\r\n        // #ifndef APP-PLUS || H5\r\n        this.createSelectorQuery()\r\n        // #endif\r\n        // #ifdef APP-PLUS\r\n        uni.createSelectorQuery().in(this)\r\n          // #endif\r\n          // #ifndef H5\r\n          .select('.top').boundingClientRect().exec(res => {\r\n            // #endif\r\n            this.width = res[0].width;\r\n            if (res[0].height == height) {\r\n              this.$emit('ready', res[0])\r\n              clearInterval(this._timer);\r\n            }\r\n            height = res[0].height;\r\n            // #ifndef H5\r\n          });\r\n        // #endif\r\n      }, 350)\r\n      if (this.showWithAnimation && !append) this.showAm = 'animation:show .5s';\r\n    },\r\n    getText (ns = this.html || this.nodes) {\r\n      // #ifdef H5\r\n      return this.rtf.innerText;\r\n      // #endif\r\n      // #ifndef H5\r\n      var txt = '';\r\n      for (var i = 0, n; n = ns[i++];) {\r\n        if (n.type == 'text') txt += n.txt.replace(/&nbsp;/g, '\\u00A0').replace(/&lt;/g, '<').replace(/&gt;/g, '>')\r\n          .replace(/&amp;/g, '&');\r\n        else if (n.type == 'br') txt += '\\n';\r\n        else {\r\n          // 块级标签前后加换行\r\n          var block = n.name == 'p' || n.name == 'div' || n.name == 'tr' || n.name == 'li' || (n.name[0] == 'h' && n.name[1] >\r\n            '0' && n.name[1] < '7');\r\n          if (block && txt && txt[txt.length - 1] != '\\n') txt += '\\n';\r\n          if (n.children) txt += this.getText(n.children);\r\n          if (block && txt[txt.length - 1] != '\\n') txt += '\\n';\r\n          else if (n.name == 'td' || n.name == 'th') txt += '\\t';\r\n        }\r\n      }\r\n      return txt;\r\n      // #endif\r\n    },\r\n    navigateTo (obj) {\r\n      if (!this.useAnchor)\r\n        return obj.fail && obj.fail({\r\n          errMsg: 'Anchor is disabled'\r\n        })\r\n      // #ifdef H5\r\n      if (!obj.id) {\r\n        window.scrollTo(0, this.rtf.offsetTop);\r\n        return obj.success && obj.success({\r\n          errMsg: 'pageScrollTo:ok'\r\n        });\r\n      }\r\n      var target = document.getElementById(obj.id);\r\n      if (!target) return obj.fail && obj.fail({\r\n        errMsg: 'Label not found'\r\n      });\r\n      obj.scrollTop = this.rtf.offsetTop + target.offsetTop;\r\n      uni.pageScrollTo(obj);\r\n      // #endif\r\n      // #ifndef H5\r\n      var Scroll = (selector, component) => {\r\n        uni.createSelectorQuery().in(component ? component : this).select(selector).boundingClientRect().selectViewport()\r\n          .scrollOffset()\r\n          .exec(res => {\r\n            if (!res || !res[0])\r\n              return obj.fail && obj.fail({\r\n                errMsg: 'Label not found'\r\n              });\r\n            obj.scrollTop = res[1].scrollTop + res[0].top;\r\n            uni.pageScrollTo(obj);\r\n          })\r\n      }\r\n      if (!obj.id) Scroll('.top');\r\n      else {\r\n        // #ifndef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n        Scroll('.top >>> #' + obj.id + ', .top >>> .' + obj.id);\r\n        // #endif\r\n        // #ifdef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n        for (var anchor of this.anchors)\r\n          if (anchor.id == obj.id)\r\n            Scroll('#' + obj.id + ', .' + obj.id, anchor.node);\r\n        // #endif\r\n      }\r\n      // #endif\r\n    },\r\n    getVideoContext (id) {\r\n      if (!id) return this.videoContexts;\r\n      else\r\n        for (var i = this.videoContexts.length; i--;)\r\n          if (this.videoContexts[i].id == id) return this.videoContexts[i];\r\n    },\r\n    // 预加载\r\n    preLoad (html, num) {\r\n      // #ifdef H5\r\n      if (html.constructor == Array)\r\n        html = this._Dom2Str(html);\r\n      var contain = document.createElement('div');\r\n      contain.innerHTML = html;\r\n      var imgs = contain.querySelectorAll('img');\r\n      for (var i = imgs.length - 1; i >= num; i--)\r\n        imgs[i].removeAttribute('src');\r\n      // #endif\r\n      // #ifndef H5\r\n      if (typeof html == 'string') {\r\n        var id = hash(html);\r\n        html = new Parser(html, this).parse();\r\n        cache[id] = html;\r\n      }\r\n      var wait = [];\r\n      (function f (ns) {\r\n        for (var i = 0, n; n = ns[i++];) {\r\n          if (n.name == 'img' && n.attrs.src && !wait.includes(n.attrs.src))\r\n            wait.push(n.attrs.src);\r\n          f(n.children || []);\r\n        }\r\n      })(html);\r\n      if (num) wait = wait.slice(0, num);\r\n      this._wait = (this._wait || []).concat(wait);\r\n      if (!this.imgs) this.imgs = this._wait.splice(0, 15);\r\n      else if (this.imgs.length < 15)\r\n        this.imgs = this.imgs.concat(this._wait.splice(0, 15 - this.imgs.length));\r\n      // #endif\r\n    },\r\n    _load (e) {\r\n      // #ifndef H5\r\n      if (this._wait.length)\r\n        this.$set(this.imgs, e.target.id, this._wait.shift());\r\n      // #endif\r\n    },\r\n    _tap (e) {\r\n      // #ifndef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n      if (this.gestureZoom && e.timeStamp - this._lastT < 300) {\r\n        var initY = e.touches[0].pageY - e.currentTarget.offsetTop;\r\n        if (this._zoom) {\r\n          this._scaleAm.translateX(0).scale(1).step();\r\n          uni.pageScrollTo({\r\n            scrollTop: (initY + this._initY) / 2 - e.touches[0].clientY,\r\n            duration: 400\r\n          })\r\n        } else {\r\n          var initX = e.touches[0].pageX - e.currentTarget.offsetLeft;\r\n          this._initY = initY;\r\n          this._scaleAm = uni.createAnimation({\r\n            transformOrigin: `${initX}px ${this._initY}px 0`,\r\n            timingFunction: 'ease-in-out'\r\n          });\r\n          // #ifdef MP-TOUTIAO\r\n          this._scaleAm.opacity(1);\r\n          // #endif\r\n          this._scaleAm.scale(2).step();\r\n          this._tMax = initX / 2;\r\n          this._tMin = (initX - this.width) / 2;\r\n          this._tX = 0;\r\n        }\r\n        this._zoom = !this._zoom;\r\n        this.scaleAm = this._scaleAm.export();\r\n      }\r\n      this._lastT = e.timeStamp;\r\n      // #endif\r\n    },\r\n    _touchstart (e) {\r\n      // #ifndef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n      if (e.touches.length == 1)\r\n        this._initX = this._lastX = e.touches[0].pageX;\r\n      // #endif\r\n    },\r\n    _touchmove (e) {\r\n      // #ifndef MP-BAIDU || MP-ALIPAY || APP-PLUS\r\n      var diff = e.touches[0].pageX - this._lastX;\r\n      if (this._zoom && e.touches.length == 1 && Math.abs(diff) > 20) {\r\n        this._lastX = e.touches[0].pageX;\r\n        if ((this._tX <= this._tMin && diff < 0) || (this._tX >= this._tMax && diff > 0))\r\n          return;\r\n        this._tX += (diff * Math.abs(this._lastX - this._initX) * 0.05);\r\n        if (this._tX < this._tMin) this._tX = this._tMin;\r\n        if (this._tX > this._tMax) this._tX = this._tMax;\r\n        this._scaleAm.translateX(this._tX).step();\r\n        this.scaleAm = this._scaleAm.export();\r\n      }\r\n      // #endif\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n@keyframes show {\r\n  0% {\r\n    opacity : 0;\r\n  }\r\n\r\n  100% {\r\n    opacity : 1;\r\n  }\r\n}\r\n\r\n/* #ifdef MP-WEIXIN */\r\n:host {\r\n  display : block;\r\n  overflow : scroll;\r\n\r\n  -webkit-overflow-scrolling : touch;\r\n}\r\n\r\n.top {\r\n  display : inherit;\r\n}\r\n\r\n/* #endif */\r\n\r\n</style>\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./jyf-parser.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./jyf-parser.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1592530769807\n      var cssReload = require(\"/Users/hammond/Documents/code/frontEnd/uni-question/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}